--create tables

CREATE TABLE `cell` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`type_id` int(11) DEFAULT NULL,
`name` varchar(20) DEFAULT NULL,
`area` float DEFAULT NULL,
`angle` float DEFAULT NULL,
`circ` float DEFAULT NULL,
`frequency` float DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `type_id_idx` (`type_id`),
CONSTRAINT `type_id` FOREIGN KEY (`type_id`) REFERENCES `type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=utf8;

CREATE TABLE `metadata` (
`id` int(11) NOT NULL,
`frame_interval` int(11) DEFAULT NULL,
`title` varchar(45) DEFAULT NULL,
`calibration` float DEFAULT NULL,
PRIMARY KEY (`id`),
UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `raw_media` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`source` blob,
`cell_id` int(11) unsigned DEFAULT NULL,
PRIMARY KEY (`id`),
UNIQUE KEY `id_UNIQUE` (`id`),
KEY `cell_id_idx` (`cell_id`),
CONSTRAINT `cell_id` FOREIGN KEY (`cell_id`) REFERENCES `cell` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8;

CREATE TABLE `time_series` (
`id` int(10) unsigned NOT NULL AUTO_INCREMENT,
`cell_id` int(10) unsigned DEFAULT NULL,
`mean1` float DEFAULT NULL,
`mean2` float DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `cell_id_idx` (`cell_id`),
CONSTRAINT `cell` FOREIGN KEY (`cell_id`) REFERENCES `cell` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=123 DEFAULT CHARSET=utf8;


CREATE TABLE `type` (
`id` int(11) NOT NULL AUTO_INCREMENT,
`type` varchar(6) DEFAULT NULL,
PRIMARY KEY (`id`),
UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8;

--insert data
INSERT INTO `cell` VALUES (1,1,'wt1',35.16,67.166,0.19,20.166),(2,1,'wt2',34.27,105.6,0.42,17.28),(3,1,'wt3',34.9,102.8,0.37,21.166),(4,1,'wt4',46.09,105.009,0.17,21.166),(5,1,'wt5',30.53,18.82,0.6,17.28),(6,2,'mut1',185.96,91.55,0.064,13.66),(7,2,'mut2',125.73,69.17,0.7,20.5),(8,2,'mut3',183.46,14.85,0.715,13.66),(9,2,'mut4',139.864,52.8,0.43,13.66),(10,2,'mut5',131.48,49.3,0.58,13.66);

INSERT INTO `metadata` VALUES (1,2,'wt lagfp 36',0.129,1),(2,2,'wt lagfp 36',0.129,2),(3,2,'wt lagfp 36',0.129,3),(4,2,'wt lagfp 36',0.129,4),(5,2,'wt lagfp 36',0.129,5),(6,1,'125 lifeact gfp 36c',0.26,6),(7,1,'125 lifeact gfp 36c',0.26,7),(8,1,'125 lifeact gfp 36c',0.26,8),(9,1,'125 lifeact gfp 36c',0.26,9),(10,1,'125 lifeact gfp 36c',0.26,10);

INSERT INTO `time_series` VALUES (2,1,483.35,476.528),(3,1,483.053,479.046),(4,1,483.022,476.095),(5,1,481.797,478.948),(6,1,483.009,476.779),(7,1,479.788,468.939),(8,1,480.641,466.555),(9,1,477.281,464.85),(10,1,479.328,464.896),(11,1,479.784,464.954),(12,1,477.312,468.546),(13,1,483.803,465.387),(14,1,484.681,462.423),(15,1,482.016,462.043),(16,1,476.459,461.414),(17,1,470.956,459.282),(18,1,472.066,460.405),(19,1,469.253,462.095),(20,1,468.95,460.092),(21,1,467.253,459.748),(22,1,466.875,461.037),(23,1,461.841,464.04),(24,1,460.378,461.877),(25,1,462.494,458.221),(26,1,463.628,452.236),(27,1,468.444,450.969),(28,1,465.434,451.469),(29,1,464.263,456.015),(30,1,464.219,457.153),(31,1,461.575,455.261),(32,1,459.359,456.629),(33,1,456.728,455.224),(34,1,457.422,454.466),(35,1,458.5,456.887),(36,1,459.612,458.377),(37,1,459.669,455.635),(38,1,459.128,452.506),(39,1,458.369,450.147),(40,1,456.053,449.515),(41,1,454.369,450.104),(42,1,453.631,451.101),(43,1,453.525,451.715),(44,1,452.006,450.423),(45,1,452.047,446.779),(46,1,451.384,445.89),(47,1,450.053,445.933),(48,1,452.109,445.528),(49,1,453.331,445.298),(50,1,452.538,444.371),(51,1,451.847,442.555),(52,1,451.734,441.745),(53,1,451.575,440.666),(54,1,453.191,442.098),(55,1,454.194,443.215),(56,1,453.45,443.712),(57,1,450.344,442.733),(58,1,451.328,442.868),(59,1,451.122,445.009),(60,1,449.253,445.328),(61,1,446.266,445.65),(62,1,446.934,444.38),(63,1,449.475,445.699),(64,1,449.422,446.926),(65,1,448.041,445.816),(66,1,443.703,447.233),(67,1,442.391,448.758),(68,1,443.044,443.337),(69,1,443.7,440.077),(70,1,443.712,438.534),(71,1,441.987,439.761),(72,1,439.612,439.034),(73,1,440.819,439.313),(74,1,441.578,440.368),(75,1,445.466,441.181),(76,1,444.372,442.982),(77,1,443.678,443.199),(78,1,441.987,441.742),(79,1,438.844,440.798),(80,1,437.541,442.319),(81,1,440.663,442.288),(82,1,440.622,442.003),(83,1,441.894,441.301),(84,1,441.691,443.35),(85,1,442.075,441.963),(86,1,442.45,440.834),(87,1,443.009,439.926),(88,1,442.575,439.38),(89,1,440.647,441.08),(90,1,440.066,444.709),(91,1,441.731,442.494),(92,1,441.816,440.377),(93,1,440.306,438.497),(94,1,438.587,438.58),(95,1,440.138,437.448),(96,1,442.872,436.62),(97,1,443.472,436.972),(98,1,444.603,436.669),(99,1,440.359,437.561),(100,1,440.663,438.663),(101,1,440.494,436.65),(102,1,441.416,438.709),(103,1,442.056,439.816),(104,1,442.538,438.337),(105,1,440.469,435.745),(106,1,438.166,434.77),(107,1,437.772,435.175),(108,1,436.878,434.672),(109,1,438.369,433.472),(110,1,437.991,433.212),(111,1,438.928,433.04),(112,1,436.694,434.589),(113,1,436.675,435.19),(114,1,439.312,434.84),(115,1,439.697,434.279),(116,1,439.272,433.73),(117,1,436.569,434.144),(118,1,436.772,434.377),(119,1,436.206,434.27),(120,1,436.459,433.88),(121,1,435.737,435.113),(122,1,435.562,435.552);

INSERT INTO `type` VALUES (1,'wild'),(2,'mut');

--Queries
--Find the smallest frequency for each type
SELECT type, min(frequency) FROM cells.cell
INNER JOIN type on cell.type_id = type.id
Group by type

--Find cells that have area greater than 100
Select * from cell
Having cell.area > 100

--Find the intensity of cells having area greater than 185
SELECT cell_id, mean1, mean2 FROM cells.time_series
Where EXISTS
( Select id, cell.area from cell
Where cell_id = id
Having cell.area > 185 )

--Find metadata for all cells of type “wild”
SELECT * FROM cells.metadata
Where cell_id = ANY
( Select cell.id
from cell INNER JOIN type on cell.type_id = type.id
where type = "wild")

--Create the indexes
CREATE INDEX cell_id ON cell (id);
CREATE INDEX time_series_id ON time_series (id);
